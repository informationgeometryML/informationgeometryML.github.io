---
title: 'Structured Natural Gradient Descent (ICML 2021)' 
date: 2021-07-05
permalink: /posts/2021/07/ICML/
tags:
  - Natural Gradient Descent
  - Information Geometry
  - Matrix Lie Groups
---

About this work {% cite lin2021tractable %}: [(Youtube) talk](https://www.youtube.com/watch?v=vEY1ZxDJX8o&t=11s), [ICML paper](https://arxiv.org/abs/2102.07405),
[poster](/img/poster.pdf) 

# Introduction

Natural-gradient descent (NGD) on structured parameter spaces  is computationally challenging.
We propose a flexible and efficient NGD method to incorporate structures. 

Our NGD method 
* generalizes the exponential natural evolutionary strategy
* recovers existing  Newton-like algorithms
* yields new structured second-order algorithms and structured adaptive-gradient methods
* gives new NGD to learn structured covariances of Gaussian, Wishart and their mixtures 

Applications:
* deep learning (adaptive-gradient), 
* non-convex optimization (structured 2nd-order),
* evolution strategies (gradient-free), 
* variational inference (multimodal density with Monte Carlo gradient).


------  
# NGD for Optimization, Inference, and Search
     	
 
A unified view for problems in optimization, inference, and search
as optimization over a parametric family `$q(w|\tau)$`:
`$$
\begin{aligned}
   \min_{ \tau \in \Omega_\tau } \mathcal{L}(\tau):= \mathrm{E}_{q(\text{w}| \tau )} \big[ \ell(w) \big] + \gamma \mathrm{E}_{q(\text{w} |\tau )} \big[ \log q(w|\tau) \big] 
\end{aligned} \tag{1}\label{1}
$$`
where `$w$` is the decision variable,  `$\ell(w)$` is a loss function, `$\Omega_\tau$` is the parameter space of `$q$`, and `$\gamma\ge 0$` is a constant.

Gradient descent and natural-gradient descent  to solve `$\eqref{1}$`:
`$$
\begin{aligned}
\textrm{GD: } &\tau_{t+1} \leftarrow \tau_t - \alpha \nabla_{\tau_t} \mathcal{L}(\tau) \\
\textrm{Standard NGD: } & \tau_{t+1} \leftarrow \tau_t - \beta\,\, \big[ \mathbf{F}_{\tau} (\tau_t) \big]^{-1} \nabla_{\tau_t} \mathcal{L}(\tau)
\end{aligned} 
$$`

Advantages of NGD:
* recovers a Newton-like update for Gaussian `$q$` with mean `$\mu$` and precision `$\mathbf{S}$`.
`$$
\begin{aligned}
\mu_{t+1}  & \leftarrow \mu_t - \beta \mathbf{S}_{t}^{-1} E_{q(\text{w}|\tau_t)}{ \big[ \nabla_w \ell( w) \big] } \\
\mathbf{S}_{t+1}  & \leftarrow (1-\beta \gamma)\mathbf{S}_t + \beta  E_{q(\text{w}|\tau_t)}{ \big[ \nabla_w^2 \ell(w) \big] }
\end{aligned} 
$$`
* is less sensitive to parameter transformations  than GD
* converges faster than GD

Challenges of Standard NGD:
* NGD could violate parameterization constraints
* Singular FIM `$\mathbf{F}_{\tau}(\tau)$` of `$q(w|\tau)$`
* Limited covariance structures
* Ad-hoc approximations for cost reductions 
* Complicated and inefficient NG computation 

 Fig 1            | Fig 2
:-------------------------:|:-------------------------:
<img src="/img/icml2021-fig01.png"  width="500"/> |  <img src="/img/icml2021-fig02.png"  width="500"/> 


    

	
# NGD using Local Parameterizations

 
* Global (original) parameterization `$\tau$` for `$q(w|\tau)$`
* New Auxiliary parameterization `$\lambda$`  with a surjective map: `$\tau= \psi(\lambda)$`
* Local parameterization`$\eta$` for `$\eta$` at a current value `$\lambda_t$` with a local map:
`$\lambda = \phi_{\lambda_t} (\eta)$`;
`$\phi_{\lambda_t}$` is
<span style="color:red"> tight </span> at `$\lambda_t$`: $\lambda_t \equiv \phi_{\lambda_t} (\eta_0)$ (we assume `$\eta_0 =\mathbf{0}$`)
`$$
\begin{aligned} 
\color{red}{\textrm{Our NGD}}: \quad
\lambda_{t+1} & \leftarrow  \phi_{\lambda_t} \big( \eta_0-\beta \hat{\mathbf{g}}_{\eta_0}^{(t)} \big) \\
\tau_{t+1} & \leftarrow \psi\big( \lambda_{t+1} \big)
\end{aligned} 
$$`
where `$\hat{\mathbf{g}}_{\eta_0}^{(t)}$` is
 the natural-gradient at `$\eta_0$` tied to `$\lambda_t$`, which is computed by the chain rule,
`$$
\begin{aligned} 
        \hat{\mathbf{g}}_{\eta_0}^{(t)} &=  \color{green} {\mathbf{F}_{\eta}(\eta_0)^{-1} } 
         \,\, \big[ \nabla_{\eta_0} \big[ \psi \circ \phi_{\lambda_t} (\eta) \big]
        \nabla_{\tau_t}\mathcal{L}(\tau) \big]  
\end{aligned} 
$$` where `$\mathbf{F}_{\eta}(\eta_0)$`  is the (exact) FIM for  `$\eta_0$` tied to  `$\lambda_t$`.   

<img src="/img/icml2021-fig03.png"  width="500"/> 
 Standard NGD is a special case of our NGD.



------
# Gaussian example with full covariance

Notations:
* `$\mathrm{GL}^{p\times p}$`: Invertible Matrices (General Linear Group),
* `$\mathcal{D}^{p\times p}$`: Diagonal Matrices,
* `$\mathcal{D}_{++}^{p\times p}$`: Diagonal and invertible Matrices (Diagonal Matrix Group),
* `$\mathcal{S}_{++}^{p\times p}$`: Positive-definite Matrices,
* `$\mathcal{S}^{p\times p}$`: Symmetric Matrices.



		
Consider a Gaussian family `$q(w|\mu,\mathbf{S})$` with mean $\mu$ and precision $\mathbf{S}=\Sigma^{-1}$.  

The global, auxiliary, and local parameterizations are:
`$$
\begin{aligned}
        \tau &= \Big\{\mu \in \mathcal{R}^p, \mathbf{S} \in \mathcal{S}_{++}^{p\times p} \Big\},  & \mathbf{S}: \text{ strictly positive-definite space } \\
        \lambda & = \Big\{ \mu \in  \mathcal{R}^p , \mathbf{B} \in\mathrm{GL}^{p\times p} \Big\}, &\mathbf{B}: \text{ (closed) matrix Lie group}\\
        \eta &= \Big\{ \delta\in  \mathcal{R}^p, \mathbf{M} \in\mathcal{S}^{p\times p}  \Big\}, & \mathbf{M}: \text{ Lie sub-algebra }
\end{aligned}
$$`


Define `$\mathbf{h}(\mathbf{M}):=\mathbf{I}+\mathbf{M}+\frac{1}{2} \mathbf{M}^2$`. 
Maps `$\psi$` and  `$\phi_{\lambda_t}$` are :
`$$
\begin{aligned}
        \Big\{ \begin{array}{c} \mu \\ \mathbf{S} \end{array} \Big\} = \psi(\lambda) & := \Big \{ \begin{array}{c} \mu \\ \mathbf{B}\mathbf{B}^\top \end{array} \Big \}, \\
       \Big \{ \begin{array}{c} \mu \\ \mathbf{B} \end{array} \Big \} = \phi_{\lambda_t}(\eta) & := \Big \{ \begin{array}{c} \mu_t + \mathbf{B}_t^{-T} \delta \\ \mathbf{B}_t \mathbf{h} (\mathbf{M}) \end{array} \Big \}.
\end{aligned}
$$`

 Our NGD in `$  \lambda $` is below, where we assume $\eta_0=\mathbf{0}$.
`$$
\begin{aligned}
\lambda_{t+1} = 
  \Big\{ \begin{array}{c} \mu_{t+1} \\ \mathbf{S}_{t+1} \end{array} \Big\} =
  \phi_{\lambda_t} \big( \eta_0-\beta \hat{\mathbf{g}}_{\eta_0}^{(t)} \big)
  =\Big\{ \begin{array}{c}  \mu_t - \beta \mathbf{B}_{t}^{-T} \mathbf{B}_t^{-1} \mathbf{g}_{\mu_t} \\ \mathbf{B}_t  \mathbf{h}\big(\beta \mathbf{B}_t^{-1}\mathbf{g}_{\Sigma_t} \mathbf{B}_t^{-T} \big) \end{array} \Big\} 
 \end{aligned}
$$`


Tractable natural-gradient at `$\eta_0=\{\delta_0, \mathbf{M}_0\}$` tied to `$\lambda_t=\{\mu_t,\mathbf{B}_t\}$`:

`$$
\begin{aligned}
    \hat{\mathbf{g}}_{\eta_0}^{(t)} =
 \Big(  \begin{array}{c} \hat{\mathbf{g}}_{\delta_0}^{(t)}\\ \mathrm{vec}(  \hat{\mathbf{g}}_{M_0}^{(t)})\end{array}   \Big)
=   \color{green}{\Big(\begin{array}{cc} \mathbf{I}_p & 0 \\ 0 & 2 \mathbf{I}_{p^2} \end{array} \Big)^{-1}}  \Big[\begin{array}{c}  \mathbf{B}_t^{-1} \mathbf{g}_{\mu_t} \\ \mathrm{vec}( -2\mathbf{B}_t^{-1} \mathbf{g}_{\Sigma_t} \mathbf{B}_t^{-T}) \end{array} \Big]
\end{aligned}
$$`

`$\mathbf{g}_\mu$` and `$\mathbf{g}_{\Sigma}$` are Euclidean gradients computed via Stein's lemma:
`$$
\begin{aligned}
\mathbf{g}_\mu &= \nabla_{\mu}\mathcal{L}(\tau) = E_{q}{ \big[ \nabla_w \ell( \mathbf{w} ) \big] }, \\
\mathbf{g}_{\Sigma}  &= \nabla_{S^{-1}}\mathcal{L}(\tau)
 = \frac{1}{2}  E_{q}{ \big[ \nabla_w^2 \ell( \mathbf{w}) \big] } - \frac{\gamma}{2} \mathbf{S} 
 \end{aligned}
$$`
 



# References
{% bibliography --cited %}

